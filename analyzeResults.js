import { HuggingFaceInference } from "langchain/llms";

const model = new HuggingFaceInference({
  model: "EleutherAI/gpt-neo-1.3B",
  apiKey: "YOUR_API_KEY",
  options: {
    truncation: 'only_first',
    max_length: 2048,
  },
});

export default async function analyzeResults(req, res) {
  if (req.method === "POST") {
    const { results } = req.body;
    const prompt = `Code snippets that are potentially vulnerable to attacks: ${results}. Tell me what kind of attacks can be performed on a website with such code snippets.`;
    const generatedText = await model.call(prompt);
    console.log({ generatedText });

    res.status(200).json({ analysis: generatedText });
  } else {
    res.setHeader("Allow", "POST");
    res.status(405).end("Method Not Allowed");
  }
}