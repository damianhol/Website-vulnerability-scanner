<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
  <title>Web Vulnerability Scanner</title>
</head>
<body>
  <h1>Web Vulnerability Scanner</h1>
  <h3>Web Vulnerability Scanner, developed as an entry for the Open Source AI Hackathon.</h3>
  <div class="icons">
    <div>
      <i class="fad fa-shield-virus"></i>
      <p>Safeguard your website by detecting SQL vulnerabilities, XSS vulnerabilities, and other potential risks such as exposed API keys.</p>
    </div>
    <p>Puppeteer, SQLMap, and DOMPurify are used for scanning, Langchain and OpenAI are used to generate concise and informative reports.</p>
    <p>Test the website you are developing to know about vulnerabilities and possible attacks!</p>
  </div>
  <form id="scanForm" onsubmit="submitForm(event)">

    <input type="url" id="url" name="url" required>
    <button type="submit" id="submitButton" style="/*! display: none; */background: transparent;border: none;"><i class="fa fa-search"></i></button>
  </form>


  <script>
console.log("Client.js loaded");

async function submitForm(event) {
  event.preventDefault(); // Prevent the default form submission behavior

  const url = document.getElementById("url").value;
  const response = await fetch("http://localhost:3000/scan", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ url }),
  });

  const results = await response.json();
  console.log(results);


  // Call the new API route to analyze the results
  const analysisResponse = await fetch("http://localhost:3000/analyze", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ results }),
  });

    const analysis = await analysisResponse.json();
    console.log(`Analysis: ${analysis.analysis}`);
  }
  </script>
</body>
</html>
